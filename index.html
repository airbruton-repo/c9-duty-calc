<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- PWA / WEB APP META TAGS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#002244" id="themeColor">
    <meta name="application-name" content="C9 Duty Calc">
    <meta name="apple-mobile-web-app-title" content="C9 Duty Calc">

    <title>C9 Duty Max Calculator</title>

    <!-- EXTERNAL LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>

<body class="flex items-start justify-center min-h-screen p-1">

    <div
        class="card-bg w-full max-w-md bg-white rounded-lg shadow-lg overflow-hidden border border-gray-100 flex flex-col relative transition-colors duration-300">

        <!-- HEADER -->
        <div
            class="header-bg bg-[#002244] text-white px-3 py-2 relative shrink-0 flex justify-between items-center transition-colors duration-300">
            <div class="flex flex-col">
                <h1 class="text-sm font-bold flex items-center gap-2">
                    <i class="fa-solid fa-plane-departure text-xs"></i> C9 Duty Max Calculator
                </h1>
                <button onclick="showInfo('firstTime')"
                    class="text-[10px] italic text-[#4ade80] hover:text-white transition-colors text-left mt-0.5">
                    First time using the calculator?
                </button>
            </div>

            <div class="flex items-center gap-4">
                <button onclick="toggleDarkMode()"
                    class="text-white/70 hover:text-white transition-colors flex items-center gap-1.5"
                    title="Toggle Theme">
                    <i id="darkModeIcon" class="fa-solid fa-moon text-[10px]"></i>
                    <span id="darkModeText" class="text-[10px] font-medium">Dark Mode</span>
                </button>
                <div class="w-px h-3 bg-white/20"></div>
                <button onclick="resetForm()"
                    class="text-[10px] text-blue-200 hover:text-white underline">Reset</button>
            </div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <div class="p-2 space-y-2">

            <!-- MODE TOGGLE -->
            <div class="seg-bg bg-gray-100 p-0.5 rounded-md flex seg-control w-full transition-colors duration-300">
                <input type="radio" name="mode" id="modeDom" value="dom" class="sr-only" checked
                    onchange="toggleMode()">
                <label for="modeDom"
                    class="seg-text flex-1 text-center py-1 text-[10px] font-bold rounded cursor-pointer flex items-center justify-center gap-4">
                    DOMESTIC
                </label>

                <input type="radio" name="mode" id="modeInt" value="int" class="sr-only" onchange="toggleMode()">
                <label for="modeInt"
                    class="seg-text flex-1 text-center py-1 text-[10px] font-bold rounded cursor-pointer flex items-center justify-center gap-4">
                    INTERNATIONAL
                </label>
            </div>

            <!-- MIXED PAIRING HELPER -->
            <div class="flex justify-center mb-1 px-1">
                <button onclick="showInfo('mixed')"
                    class="text-[#005DAA] text-[10px] font-medium hover:underline flex items-center gap-1">
                    Not sure? See Definitions <i class="fa-solid fa-circle-question"></i>
                </button>
            </div>

            <!-- ROW 1: Date & Base -->
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <div class="flex justify-between items-baseline mb-0.5 min-h-[14px]">
                        <label class="text-sub block text-[10px] font-bold text-gray-500 uppercase">Duty Period
                            Date</label>
                    </div>
                    <input type="date" id="dutyDate"
                        class="input-bg w-full px-2 bg-gray-50 border border-gray-200 rounded text-xs font-medium text-gray-900 h-8 transition-colors duration-300"
                        onchange="updateAllLabels(); resetResult();">
                </div>
                <div>
                    <div class="flex justify-between items-baseline mb-0.5 min-h-[14px]">
                        <label class="text-sub block text-[10px] font-bold text-gray-500 uppercase">Pairing
                            Origination</label>
                    </div>
                    <div class="relative">
                        <select id="homeBase"
                            class="input-bg w-full px-2 bg-gray-50 border border-gray-200 rounded text-xs font-bold text-[#002244] appearance-none h-8 transition-colors duration-300"
                            onchange="checkCoTerminal(); resetResult();">
                        </select>
                        <i
                            class="fa-solid fa-chevron-down absolute right-2 top-2.5 text-[8px] text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
            </div>

            <!-- CO-TERMINAL (Dynamic) -->
            <div id="coTermContainer"
                class="hidden coterm-bg bg-blue-50 border border-blue-100 rounded p-1.5 transition-all">
                <div class="flex items-center gap-1">
                    <input type="checkbox" id="isCoTerm" class="w-3.5 h-3.5 text-[#005DAA] rounded"
                        onchange="toggleCoTermDropdown(); resetResult();">
                    <label for="isCoTerm"
                        class="text-[10px] font-bold text-[#002244] select-none text-current cursor-pointer">End at
                        Co-Terminal?</label>
                    <button onclick="showInfo('coterm')"
                        class="icon-blue text-[#005DAA] text-[10px] hover:underline p-1"><i
                            class="fa-solid fa-circle-question"></i></button>
                </div>
                <div id="coTermDropdownContainer" class="hidden mt-1 pl-5">
                    <select id="coTermSelect"
                        class="coterm-select w-full p-1 text-[10px] bg-white border border-blue-200 rounded text-gray-700 h-7 transition-colors duration-300"
                        onchange="resetResult();">
                        <option value="0">Select Terminal...</option>
                    </select>
                </div>
            </div>

            <!-- REPORT INFO GROUP -->
            <div class="group-bg rounded p-2 pt-1.5 transition-colors duration-300">
                <div class="flex items-center gap-1 mb-1.5 border-b border-gray-200 pb-1 section-title">
                    <i class="fa-solid fa-clock text-[#005DAA] text-xs section-icon"></i>
                    <h3 class="text-[11px] font-bold text-[#002244] uppercase tracking-widest section-title">Report for
                        Duty Info</h3>
                    <button onclick="showInfo('report')"
                        class="icon-blue text-[#005DAA] text-[10px] hover:underline ml-1"><i
                            class="fa-solid fa-circle-question"></i></button>
                </div>

                <!-- ROW 1: City, Time Zone, Local Report Time -->
                <div class="grid grid-cols-[1fr_1.8fr_1.8fr] gap-2 mb-2 items-end">
                    <!-- City -->
                    <div class="relative">
                        <label
                            class="text-sub block text-[10px] font-bold text-gray-500 uppercase mb-0.5 w-[50px] leading-tight">Report<br>City</label>
                        <input type="text" id="reportAirport" placeholder="CODE" maxlength="3"
                            class="input-bg w-full px-2 bg-white border border-gray-200 rounded text-xs font-black text-gray-900 uppercase h-8 placeholder-gray-400 transition-colors duration-300"
                            oninput="validateAirport(this); resetResult(); updateLiveCalc();">
                    </div>

                    <!-- Time Zone -->
                    <div class="relative">
                        <!-- Label Row with Nudge Buttons -->
                        <div class="flex items-center justify-between mb-0.5">
                            <button id="repNudgeWest" onclick="nudgeZone('rep', -1); event.preventDefault();"
                                class="invisible text-gray-400 hover:text-[#005DAA] transition-colors text-xs px-1"
                                title="Move West"><i class="fa-solid fa-minus"></i></button>
                            <label
                                class="text-sub block text-[10px] font-bold text-gray-500 uppercase text-center leading-tight">Time<br>Zone</label>
                            <button id="repNudgeEast" onclick="nudgeZone('rep', 1); event.preventDefault();"
                                class="invisible text-gray-400 hover:text-[#005DAA] transition-colors text-xs px-1"
                                title="Move East"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div id="repZoneAutoContainer" class="w-full">
                            <input type="text" id="repZoneAuto" readonly tabindex="-1" value="--"
                                class="info-field w-full px-2 rounded text-xs font-bold text-center h-8 pointer-events-none transition-colors duration-300">
                        </div>
                        <div id="repManualContainer" class="hidden w-full">
                            <select id="repManualZone"
                                class="manual-zone-select w-full px-1 border rounded text-[10px] h-8 appearance-none text-center font-bold">
                                <option value="" disabled selected>Select</option>
                            </select>
                        </div>
                    </div>

                    <!-- Local Report Time -->
                    <div class="relative">
                        <label
                            class="text-sub block text-[10px] font-bold text-gray-500 uppercase mb-0.5 text-center leading-tight">
                            <span id="rtLabelCity">Local</span><br>Report Time
                        </label>
                        <input type="text" id="reportTime" inputmode="numeric" placeholder="HHMM" maxlength="11"
                            class="input-bg w-full px-2 bg-white border border-gray-200 rounded text-xs font-medium text-gray-900 font-mono tracking-wider h-8 placeholder-gray-400 text-center transition-colors duration-300"
                            oninput="formatTimeInput(this); resetResult(); updateLiveCalc();"
                            onblur="padTimeInput(this)">
                    </div>
                </div>


            </div>



            <!-- DEPARTURE FLIGHT GROUP -->
            <div class="group-bg rounded p-2 pt-1.5 transition-colors duration-300 mt-1">
                <div class="flex items-center gap-1 mb-1.5 border-b border-gray-200 pb-1 section-title">
                    <i class="fa-solid fa-plane-departure text-[#005DAA] text-xs section-icon"></i>
                    <h3 class="text-[11px] font-bold text-[#002244] uppercase tracking-widest section-title">Departure
                        Flight Info</h3>
                    <button onclick="showInfo('departure')"
                        class="icon-blue text-[#005DAA] text-[10px] hover:underline ml-1"><i
                            class="fa-solid fa-circle-question"></i></button>
                </div>

                <!-- ROW 1: City, Time Zone, Flight Time -->
                <div class="grid grid-cols-[1fr_1.8fr_1.8fr] gap-2 mb-2 items-end">
                    <!-- City -->
                    <div class="relative">
                        <label
                            class="text-sub block text-[10px] font-bold text-gray-500 uppercase mb-0.5 leading-tight">Departure<br>City</label>
                        <input type="text" id="depAirport" placeholder="CODE" maxlength="3"
                            class="input-bg w-full px-2 bg-white border border-gray-200 rounded text-xs font-black text-gray-900 uppercase h-8 placeholder-gray-400 transition-colors duration-300"
                            oninput="validateAirport(this); resetResult(); updateLiveCalc();">
                    </div>

                    <!-- Time Zone -->
                    <div class="relative">
                        <!-- Label Row with Nudge Buttons -->
                        <div class="flex items-center justify-between mb-0.5">
                            <button id="depNudgeWest" onclick="nudgeZone('dep', -1); event.preventDefault();"
                                class="invisible text-gray-400 hover:text-[#005DAA] transition-colors text-xs px-1"
                                title="Move West"><i class="fa-solid fa-minus"></i></button>
                            <label
                                class="text-sub block text-[10px] font-bold text-gray-500 uppercase text-center leading-tight">Time<br>Zone</label>
                            <button id="depNudgeEast" onclick="nudgeZone('dep', 1); event.preventDefault();"
                                class="invisible text-gray-400 hover:text-[#005DAA] transition-colors text-xs px-1"
                                title="Move East"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div id="depZoneAutoContainer" class="w-full">
                            <input type="text" id="depZoneAuto" readonly tabindex="-1" value="--"
                                class="info-field w-full px-2 rounded text-xs font-bold text-center h-8 pointer-events-none transition-colors duration-300">
                        </div>
                        <div id="depManualContainer" class="hidden w-full">
                            <select id="depManualZone" onchange="resetResult();"
                                class="manual-zone-select w-full px-1 border rounded text-[10px] h-8 appearance-none text-center font-bold">
                                <option value="" disabled selected>Select</option>
                            </select>
                        </div>
                    </div>

                    <!-- Scheduled Flight Time -->
                    <div class="relative">
                        <!-- Warning Popup -->
                        <div id="flightTimeWarning"
                            class="hidden absolute -top-8 left-1/2 -translate-x-1/2 w-[180px] bg-red-50 border border-red-200 shadow-lg rounded px-2 py-1 z-20 flex items-center justify-between gap-2">
                            <span class="text-[9px] font-bold text-red-600 leading-none">Make sure to use the
                                <i>scheduled</i> pairing info and NOT the "updated" version.</span>
                            <button onclick="dismissFlightWarning()" class="text-red-400 hover:text-red-700"><i
                                    class="fa-solid fa-xmark text-xs"></i></button>
                        </div>

                        <label
                            class="text-sub block text-[10px] font-bold text-gray-500 uppercase mb-0.5 text-center leading-tight">
                            Scheduled<br>Flight Time
                        </label>
                        <input type="text" id="flightTimeInput" inputmode="numeric" placeholder="HHMM" maxlength="5"
                            class="input-bg w-full px-2 bg-white border border-gray-200 rounded text-xs font-medium text-gray-900 font-mono tracking-wider h-8 placeholder-gray-400 text-center transition-colors duration-300"
                            oninput="formatTimeInput(this); resetResult(); updateLiveCalc();"
                            onblur="padTimeInput(this)">
                    </div>
                </div>
            </div>

            <!-- MODIFIERS GROUP -->
            <div class="group-bg rounded p-2 pt-1.5 transition-colors duration-300 mt-1">
                <div class="flex items-center gap-1 mb-1 border-b border-gray-200 pb-1 section-title">
                    <i class="fa-solid fa-sliders text-[#005DAA] text-xs section-icon"></i>
                    <h3 class="text-[11px] font-bold text-[#002244] uppercase tracking-widest section-title">Modifiers
                    </h3>
                </div>
                <div class="text-[11px] text-gray-600 font-medium italic mb-1.5 ml-0.5">Select all that apply:</div>

                <div class="grid grid-cols-4 gap-2">
                    <!-- HVT (Moved Back) -->
                    <div class="flex flex-col items-center gap-1" id="hvtContainer">
                        <label class="cursor-pointer w-full"><input type="checkbox" id="isHVT"
                                class="toggle-checkbox sr-only" onchange="resetResult()">
                            <div
                                class="opt-pill h-7 rounded border font-bold flex items-center justify-center transition-colors select-none text-[10px]">
                                HVT</div>
                        </label>
                        <button onclick="showInfo('hvt')"
                            class="icon-blue text-[#005DAA] text-[12px] hover:underline pt-0.5"><i
                                class="fa-solid fa-circle-question"></i></button>
                    </div>

                    <div class="flex flex-col items-center gap-1">
                        <label class="cursor-pointer w-full"><input type="checkbox" id="isDHD"
                                class="toggle-checkbox sr-only" onchange="resetResult()">
                            <div
                                class="opt-pill h-7 rounded border font-bold flex items-center justify-center transition-colors select-none text-[10px]">
                                DHD</div>
                        </label>
                        <button onclick="showInfo('dhd')"
                            class="icon-blue text-[#005DAA] text-[12px] hover:underline pt-0.5"><i
                                class="fa-solid fa-circle-question"></i></button>
                    </div>

                    <div class="flex flex-col items-center gap-1">
                        <label class="cursor-pointer w-full"><input type="checkbox" id="customsStart"
                                class="toggle-checkbox sr-only" onchange="resetResult()">
                            <div
                                class="opt-pill h-7 rounded border font-bold flex items-center justify-center transition-colors select-none text-center leading-none text-[10px]">
                                Customs<br>at Start</div>
                        </label>
                        <button onclick="showInfo('custStart')"
                            class="icon-blue text-[#005DAA] text-[12px] hover:underline pt-0.5"><i
                                class="fa-solid fa-circle-question"></i></button>
                    </div>

                    <div class="flex flex-col items-center gap-1">
                        <label class="cursor-pointer w-full"><input type="checkbox" id="customsEnd"
                                class="toggle-checkbox sr-only" onchange="resetResult()">
                            <div
                                class="opt-pill h-7 rounded border font-bold flex items-center justify-center transition-colors select-none text-center leading-none text-[10px]">
                                Customs<br>at End</div>
                        </label>
                        <button onclick="showInfo('custEnd')"
                            class="icon-blue text-[#005DAA] text-[12px] hover:underline pt-0.5"><i
                                class="fa-solid fa-circle-question"></i></button>
                    </div>
                </div>
            </div>

            <!-- CALCULATE BUTTON -->
            <button id="btnCalculate"
                class="w-full bg-[#005DAA] active:bg-[#004c8c] text-white font-bold py-2.5 rounded shadow-sm text-xs mt-1 transition-transform active:scale-[0.98]">CALCULATE
                DOOR CLOSE</button>

            <!-- ERROR MESSAGE -->
            <div id="errorContainer"
                class="hidden bg-red-50 border border-red-200 text-red-700 p-1.5 rounded text-[10px] flex items-center gap-2">
                <i class="fa-solid fa-circle-exclamation"></i><span id="errorMsg"></span>
            </div>

            <!-- RESULT CARD -->
            <div id="resultCard"
                class="hidden bg-gray-900 text-white rounded-lg shadow border-t-2 border-[#005DAA] overflow-hidden">
                <div class="p-4 text-center relative">
                    <button id="btnCopyReceipt"
                        class="absolute right-3 top-3 text-gray-400 hover:text-white transition-colors"
                        title="Copy Receipt for Scheduling">
                        <i class="fa-regular fa-copy text-lg"></i>
                    </button>

                    <h2 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">Latest Legal Door
                        Closure</h2>
                    <div class="flex flex-col items-center">
                        <span id="resultTime"
                            class="text-5xl font-bold text-white leading-none tracking-tight my-1">--:--</span>
                        <span id="resultZone" class="text-blue-300 text-sm font-medium mt-1">Local Time</span>
                    </div>
                </div>

                <!-- BREAKDOWN ACCORDION -->
                <details class="group border-t border-gray-800" open>
                    <summary
                        class="flex items-center justify-center gap-2 p-2 bg-gray-800/50 cursor-pointer text-xs text-gray-400 uppercase font-bold tracking-wider hover:bg-gray-800 select-none">
                        <span>Show Breakdown</span>
                        <i class="fa-solid fa-chevron-down group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-4 bg-gray-800 text-sm font-mono space-y-1 text-gray-300">
                        <div class="grid grid-cols-[1fr,auto] gap-x-4 gap-y-2">
                            <div class="text-gray-400">Report (Local)</div>
                            <div id="calcStepReportLocal" class="text-right text-white font-medium">--</div>

                            <div class="text-blue-300 text-xs pl-2">â†³ Report (HDT)</div>
                            <div id="calcStepReportHDT" class="text-right text-blue-300 text-xs font-medium">--</div>

                            <div class="col-span-2 border-t border-gray-700 my-1"></div>

                            <div class="text-white">= Report (Dep City)</div>
                            <div id="calcStepReportDep" class="text-right text-white font-bold">--</div>

                            <div class="text-blue-300">+ Max Duty</div>
                            <div id="calcStepMax" class="text-right text-blue-300 font-bold">--</div>

                            <div class="col-span-2 text-right text-xs text-blue-400 italic" id="calcStepMaxExplanation">
                            </div>

                            <div class="col-span-2 border-b border-gray-600 my-1"></div>

                            <div class="text-gray-300 font-bold" id="calcStepStopLabel">= Duty Hard Stop</div>
                            <div id="calcStepStop" class="text-right text-white font-bold">--</div>

                            <div id="rowCoTermLabel" class="text-red-300 hidden">- Co-Term Travel</div>
                            <div id="valCoTerm" class="text-right text-red-300 hidden font-bold">--</div>

                            <div class="text-red-300" id="calcStepDebriefLabel">- Debrief</div>
                            <div id="calcStepDebriefVal" class="text-right text-red-300 font-bold">--</div>

                            <div id="calcStepCustomsRowLabel" class="text-red-300 hidden">- Customs</div>
                            <div id="calcStepCustoms" class="text-right text-red-300 hidden font-bold">--</div>

                            <div class="text-red-300">- Scheduled Flt Time</div>
                            <div id="calcStepFlight" class="text-right text-red-300 font-bold">--</div>

                            <div class="col-span-2 border-t border-gray-600 my-1"></div>

                            <div class="text-white font-bold text-base pt-1">= Door Closure</div>
                            <div id="calcStepResult" class="text-right text-white font-bold text-base pt-1">--</div>
                        </div>
                    </div>
                </details>

                <!-- DISCLAIMER -->
                <div class="disclaimer-box p-3 text-xs leading-snug">
                    <strong class="block mb-0.5"><i class="fa-solid fa-triangle-exclamation"></i> INFORMATIONAL
                        ONLY</strong>
                    Never refuse a trip based on this tool. If you believe you are illegal, contact a Scheduling
                    Supervisor. If unresolved, fly the trip and file a Local Council Worksheet. Refusal may constitute
                    insubordination.
                </div>
            </div>
        </div>

        <!-- INFO MODAL -->
        <div id="infoModal" onclick="if(event.target === this) closeInfo()"
            class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
            <div class="modal-bg bg-white rounded-lg shadow-2xl w-full max-w-xs p-4 text-center">
                <div class="icon-blue mb-2 text-[#005DAA] text-2xl"><i class="fa-solid fa-circle-info"></i></div>
                <h3 id="modalTitle" class="text-sm font-bold mb-1"></h3>
                <div id="modalText"
                    class="modal-text text-xs text-gray-600 leading-relaxed mb-3 whitespace-pre-wrap text-left"></div>
                <button onclick="closeInfo()"
                    class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-1.5 rounded text-xs transition-colors text-black">Close</button>
            </div>
        </div>

        <!-- HIDDEN COPY AREA -->
        <textarea id="copyArea" class="absolute -left-96 opacity-0"></textarea>
    </div>

    <!-- DATA LIST FOR AIRPORTS -->
    <datalist id="airportList"></datalist>

    <script src="data.js"></script>
    <script src="script.js"></script>
</body>

</html>